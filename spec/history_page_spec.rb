require 'spec_helper'

describe MinimedRF::HistoryPage do
  it "should decode data" do
    data = "6ebf0f050000000000000002be02be640000000000000000000000000000000000000000000000000000000000000000000000007b0180de08010f11220006040c1e80c051410f0c0488c411010f7b018ac411010f11220006040c1eb1e651410f1a008fee11010f060303688fee71010f0c040e400001070c030f4000010764001f4000010717003740000107180080f616080f07000001efa18f0000006ea18f050000000000000001ef01ef64000000000000000000000000000000000000000000000000000000000000000000000000210084f616080f0b6b0080f736a80f030000002085f736080f7b0297f716080f2c1c007b0080c000090f001600070000001ea88f0036166ea88f0500000000000000001e001e6400000000000000000000000000000000006000000000000000000000000000c0000000b07b0180de08090f1122007b0280c016090f2c1c007b0080c0000a0f00160007000002bea98f0000006ea98f050000000000000002be02be640000000000000000000000000000000000000000000000000000000000000000000000007b0180de080a0f1122007b0280c0160a0f2c1c007b0080c0000b0f00160007000002beaa8f0000006eaa8f050000000000000002be02be640000000000000000000000000000000000000000000000000000000000000000000000007b0180de080b0f1122007b0280c0160b0f2c1c007b0080c0000c0f00160007000002beab8f0000006eab8f050000000000000002be02be640000000000000000000000000000000000000000000000000000000000000000000000007b0180de080c0f1122007b0280c0160c0f2c1c007b0080c0000d0f00160007000002beac8f0000006eac8f050000000000000002be02be640000000000000000000000000000000000000000000000000000000000000000000000007b0180de080d0f1122007b0280c0160d0f2c1c007b0080c0000e0f00160007000002bead8f0000006ead8f050000000000000002be02be640000000000000000000000000000000000000000000000000000000000000000000000007b0180de080e0f11220034649cf8140e0f0a6495fb340e0f5b64affb140e0f0f5000783c4100003200000000328c0100320032000000b0fb340e0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000095ba"
    history_page = MinimedRF::HistoryPage.new([data].pack('H*'))
    entries = history_page.decode
    expect(entries.length).to eq 51

    sara6e = entries[0]
    expect(sara6e.timestamp).to eq [2015, 10, 31, 0, 0, 0]

    calbg = entries[48]
    expect(calbg.to_s).to eq "CalBGForPH 2015/11/14 20:59:21 BG:100"

    bw = entries[49]
    expect(bw.blood_glucose).to eq 100
    expect(bw.bg_target_high).to eq 140
    expect(bw.unabsorbed_insulin_total).to eq 0
    expect(bw.correction_estimate).to eq 0
    expect(bw.bolus_estimate).to eq 1.25
    expect(bw.bg_target_low).to eq 65
    expect(bw.carb_ratio).to eq 12
    expect(bw.food_estimate).to eq 1.25
    expect(bw.carbohydrates).to eq 15
    expect(bw.insulin_sensitivity).to eq 60
  end
end
